// Initialize canvas and context
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Game variables
let birdX = 50;
let birdY = canvas.height / 2;
let birdSpeedY = 0;
const gravity = 0.5;
const jumpStrength = -8;
let score = 0;
let gameOver = false;

// Pipe variables
const pipeWidth = 50;
const pipeGap = 150;
let pipes = [];

// Event listener for spacebar to jump
document.addEventListener('keydown', function(event) {
  if (event.code === 'Space') {
    if (!gameOver) {
      birdSpeedY = jumpStrength;
    } else {
      resetGame();
    }
  }
});

// Game loop
function gameLoop() {
  // Clear canvas
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Update bird position
  birdY += birdSpeedY;
  birdSpeedY += gravity;

  // Draw bird
  ctx.fillStyle = '#FF5733';
  ctx.fillRect(birdX, birdY, 30, 30);

  // Generate new pipes
  if (Math.random() < 0.02 && pipes.length < 4) {
    let pipeY = Math.floor(Math.random() * (canvas.height - pipeGap));
    pipes.push({ x: canvas.width, y: pipeY });
  }

  // Update and draw pipes
  for (let i = pipes.length - 1; i >= 0; i--) {
    pipes[i].x -= 2;

    // Remove pipes off screen
    if (pipes[i].x + pipeWidth < 0) {
      pipes.splice(i, 1);
      score++;
    }

    // Check collision with pipes
    if (birdX < pipes[i].x + pipeWidth &&
        birdX + 30 > pipes[i].x &&
        (birdY < pipes[i].y || birdY + 30 > pipes[i].y + pipeGap)) {
      gameOver = true;
    }

    // Draw top and bottom pipes
    ctx.fillStyle = '#008000';
    ctx.fillRect(pipes[i].x, 0, pipeWidth, pipes[i].y);
    ctx.fillRect(pipes[i].x, pipes[i].y + pipeGap, pipeWidth, canvas.height);
  }

  // Draw score
  ctx.fillStyle = '#000';
  ctx.font = '24px Arial';
  ctx.fillText(`Score: ${score}`, 10, 30);

  // Check collision with ceiling and ground
  if (birdY < 0 || birdY + 30 > canvas.height) {
    gameOver = true;
  }

  // Game over
  if (gameOver) {
    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#FFF';
    ctx.font = '36px Arial';
    ctx.fillText('Game Over', canvas.width / 2 - 100, canvas.height / 2);
    ctx.fillText('Press Space to Restart', canvas.width / 2 - 180, canvas.height / 2 + 50);
    return;
  }

  // Request next frame
  requestAnimationFrame(gameLoop);
}

// Function to reset the game
function resetGame() {
  birdY = canvas.height / 2;
  birdSpeedY = 0;
  pipes = [];
  score = 0;
  gameOver = false;
  gameLoop();
}

// Start the game loop
gameLoop();
